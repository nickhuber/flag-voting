{% extends "_base.html" %}

{% block content %}
  <div class="container">
    <div class="flag-container row">
      <div class="col-sm">
        <div class="flag " id="flag-1">
          <img src="{% url 'flag' vote.choice_1.id %}">
        </div>
      </div>
      <div class="col-sm">
        <div class="flag " id="flag-2">
          <img src="{% url 'flag' vote.choice_2.id %}">
        </div>
      </div>
    </div>
    <div class="py-5 text-center">
      <h2>The ultimate flag preference voting system</h2>
      <p class="lead">Choose one of the above flags, repeat until bored.</p>
    </div>
  </div>
{% csrf_token %}
{% endblock %}

{% block head %}
<style>
.flag-container { align-items: center; gap: 20px; }
.flag { box-shadow: 2px 2px 12px #928374;  margin-top: 1ex; }
</style>
{% endblock %}

{% block scripts %}
<script>
  (function () {
    const vote_id = "{{ vote.id }}";
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    document.getElementById("flag-1").onclick = function () {
      fetch("choice/", {
        method: "POST",
        headers: { "Content-Type": "application/json", "X-CSRFToken": csrftoken },
        body: JSON.stringify({ chosen_flag_id: {{ vote.choice_1.id }} })
      }).then(response => location.reload());
    }
    document.getElementById("flag-2").onclick = function () {
      fetch("choice/", {
        method: "POST",
        headers: { "Content-Type": "application/json", "X-CSRFToken": csrftoken },
        body: JSON.stringify({ chosen_flag_id: {{ vote.choice_2.id }} })
      }).then(response => location.reload());
    }
  })();
</script>
{% endblock %}
